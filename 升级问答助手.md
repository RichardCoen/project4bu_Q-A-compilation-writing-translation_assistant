# 升级智能工作助手｜升级问答助手

## 概述
- 提供通用问答、知识库问答、文档问答三大模式，覆盖多场景智能交互。
- 支持推理模型与思考模型灵活切换：前者偏逻辑分析与复杂求解，后者偏深度理解与自然表达。
- 支持基于历史上下文的连续对话，并可上传文档进行解析与基于文档的问答。

## 架构
- 对话前端：消息输入输出、模式切换、上下文视图与附件上传。
- 会话管理服务：上下文拼接、历史追踪、话题分段与引用管理。
- 模型编排服务：推理/思考模型选择、参数管理、负载均衡与容错。
- 文档解析与索引：文档抽取、格式适配、分块与嵌入、向量索引。
- 检索增强（RAG）：语义检索、精排与重排序、证据拼接与引用。
- 知识库管理：库的创建、同步、权限控制与更新策略。
- 安全与权限：用户鉴权、数据隔离、敏感信息过滤与合规。
- 监控与质量：反馈采集、评价指标、会话质量巡检与告警。

## 架构设计
- 前端交互层：提供消息输入、模式切换、文件上传与结果展示；对话窗口支持引用展开与原文定位，维持两栏视图（会话区与证据/附件区），保障信息核验与追溯。
- 应用服务层：鉴权与会话管理、模型路由与参数编排、文档解析与索引、检索增强与答案生成、引用标注与导出服务。以可扩展流水线衔接解析→检索→生成，支持异步处理防止界面阻塞。
- 数据存储层：对象存储保存原始附件（加密），关系型库保存用户信息、会话元数据、知识库配置与任务状态，向量库保存文档块嵌入。实现访问控制、HTTPS 传输、密钥轮换与备份恢复，保障安全与可用性。

## 功能
### 通用问答
支持开放域问答与工具调用，覆盖从事实查询到简要分析的通用场景。系统根据问题类型选择适合的推理或思考路径，提供清晰结构化答案，并在必要时返回来源或操作步骤，保证结果可理解、可验证与可复用。

### 知识库问答
面向企业或项目知识库进行检索增强回答，结合语义召回与精排，将相关条目、规章与流程作为证据引用。支持分层权限与库更新策略，确保回答与组织最新知识保持一致，并可追溯引用内容与版本。

### 文档问答
支持上传 PDF、Word、Markdown 与纯文本，系统进行分块解析与索引构建。问答时以文档为上下文检索相关片段，并在回答中引用出处与段落位置，保证答案贴近原文与事实依据，适合审阅与学习场景。

### 模型切换
提供推理模型与思考模型的灵活切换，前者擅长结构化分析与复杂求解，后者更注重自然表达与语义连贯。可按任务预设策略或在会话中实时调整，确保不同问题类型获得最优的回答质量与风格。

### 上下文连续对话
维护多轮会话记忆，支持话题分段与引用上下文，使对话在长链路中保持一致性。用户可回溯历史并标注重点，系统在生成时自动关联先前信息，减少重复提问与偏差，提升交互连贯性与效率。

### 文档上传与解析
适配多格式文档，执行正文抽取、版式识别与分块归并。对表格与标题层级进行结构恢复，生成可检索索引与摘要。解析结果与原文件保持链接，以便快速定位原文内容并进行准确引用与比对。

### 检索增强
生成嵌入并写入向量索引，结合语义召回与精排策略，确保高相关片段进入回答阶段。支持重排序与去噪处理，提升检索质量与证据可信度。在复杂问题中以多段证据拼接形成完整答案。

### 会话存储
保存聊天记录与标签，支持搜索、归档与导出。会话元数据用于质量评估与模型反馈优化，便于复盘与复用。提供权限与留痕管理，保障敏感信息与重要讨论的安全与合规。

## 流程设计
- 主流程
  1) 入口与鉴权：用户从首页进入问答助手，未登录则完成登录/注册；鉴权通过后进入功能页（确保附件与回答仅对当前用户可见）。
  2) 模式选择与输入：用户选择通用/知识库/文档问答，输入问题或上传附件；系统执行基础校验（大小、格式白名单、必要元信息）。
  3) 安全存储与判断：校验通过后对附件加密落地至对象存储，记录任务状态并判断上传是否成功；失败则提示重试/重新上传。
  4) 文档解析与索引：对上传文档进行解析、分块与嵌入，生成可检索的向量索引，并与原文位置建立映射。
  5) 检索与答案生成（并行）：在同一上下文触发语义检索、精排与模型生成；通用问答走直接生成路径，知识库/文档问答走 RAG 路径并携带证据。
  6) 结果展示与联动：在会话区展示答案，在证据区展示引用片段与原文定位，支持点击跳转与上下文核验，形成“证据引用—答案验证”的闭环。
  7) 导出/分享：用户选择导出格式（TXT、Markdown、PDF），系统生成导出文件并判断是否成功；成功则提供下载/分享入口，失败允许重试。
- 关键分支与异常闭环
  1) 未登录分支：未登录→引导登录→成功后回到问答助手入口继续，不丢失上下文与附件列表。
  2) 格式不支持/校验失败：上传校验不通过→提示支持格式与限制→返回重新选择附件或改用通用问答。
  3) 上传失败：云存储失败/网络中断→提示失败原因→支持重试或重新上传。
  4) 解析失败：分块/嵌入失败→提示原因与建议（更换格式/重新上传）→回到上传。
  5) 检索/生成失败：检索无相关或模型出错→提示重试与问题改写建议→保留会话供继续追问。
  6) 导出失败：导出文件生成失败→提示重试/更换格式→回到导出选择。
- 模块功能联系
  1) 上传/存储定义权限边界并提供统一输入。
  2) 解析预处理将多格式文档统一为标准化索引，是知识库与文档问答的共同前置。
  3) 检索增强为生成提供证据，引用定位确保答案可核验。
  4) 导出封装会话与证据形成可交付产物，完成从互动到复用的闭环。

## 技术
- RAG 检索增强：通过语义向量化、分块索引与精排重排序，将高相关片段送入生成阶段，并以证据引用保证可追溯与可信。支持多源知识融合与噪声抑制，提升回答准确性。
- 多模型路由与会话管理：依据问题类型与上下文状态在推理/思考模型间切换，结合会话记忆与话题分段控制生成策略，兼顾逻辑严密与表达自然，提升交互体验与质量稳定性。
