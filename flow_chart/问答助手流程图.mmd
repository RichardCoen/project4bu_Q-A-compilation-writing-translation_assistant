flowchart TD
  A[入口与鉴权] -->|未登录| A1[引导登录/注册]
  A1 --> A
  A --> B[模式选择与输入]
  B --> C{上传校验通过?（大小/格式/元信息）}
  C -- 否 --> C1[提示原因并返回重新选择]
  C -- 是 --> D[加密存储附件]
  D --> E[文档解析与索引（分块/嵌入）]
  B --> F{问答类型}
  F -- 通用问答 --> G1[直接生成答案]
  F -- 知识库/文档问答 --> G2[RAG 检索与生成]
  E --> G2
  G1 --> H[结果展示与引用区]
  G2 --> H
  H --> I[导出/分享（TXT/Markdown/PDF）]
  I --> J{导出成功?}
  J -- 否 --> J1[提示并允许重试/更换格式]
  J -- 是 --> J2[提供下载/分享入口]
  X1[未登录] --> A1
  X2[格式不支持/校验失败] --> C1
  X3[上传失败/网络中断] --> D
  X4[解析失败] --> E
  X5[检索/生成失败] --> H
  X6[导出失败] --> J1
